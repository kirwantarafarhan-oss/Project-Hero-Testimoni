<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>H.E.R.O - Highschool Entrepreneur Race OSIS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    * { font-family: 'Inter', sans-serif; }
    .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    .hover-scale { transition: transform 0.2s; }
    .hover-scale:hover { transform: scale(1.02); }
    .truncate-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-[#F7F8FA] min-h-screen">

  <!-- Main Container -->
  <div class="min-h-screen flex flex-col md:flex-row bg-[#F7F8FA]" id="app">
    
    <!-- Sidebar -->
    <aside class="w-full md:w-20 lg:w-64 bg-[#0F0F0F] text-white p-6 flex flex-col gap-8 md:flex hidden sticky top-0 h-screen border-r border-white/5 shadow-2xl">
      <div class="flex flex-col gap-1 items-center lg:items-start">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-gradient-to-br from-[#EC0000] to-[#800000] rounded-2xl flex items-center justify-center shadow-xl shadow-red-600/20 border border-white/10">
            <i class="fa-solid fa-rocket text-white text-2xl"></i>
          </div>
          <div class="hidden lg:block">
            <h1 class="font-black text-2xl tracking-tighter bg-gradient-to-r from-white via-slate-300 to-slate-500 bg-clip-text text-transparent uppercase">
              H.E.R.O
            </h1>
          </div>
        </div>
        <p class="text-[9px] uppercase font-bold text-slate-500 leading-tight mt-6 tracking-[0.15em] hidden lg:block opacity-60">
          Highschool Entrepreneur<br>Race OSIS
        </p>
      </div>

      <nav class="flex flex-col gap-3 mt-4">
        <button id="dashboardTab" class="flex items-center gap-4 p-4 rounded-2xl font-bold transition-all duration-300 bg-gradient-to-r from-[#EC0000] to-[#FF4D4D] text-white shadow-lg shadow-red-500/30">
          <i class="fa-solid fa-chart-pie w-5"></i> <span class="hidden lg:block text-sm">Race Board</span>
        </button>
        <button id="managementTab" class="flex items-center gap-4 p-4 rounded-2xl font-bold transition-all duration-300 text-slate-500 hover:text-white hover:bg-white/5">
          <i class="fa-solid fa-gear w-5"></i> <span class="hidden lg:block text-sm">Data Master</span>
        </button>
      </nav>

      <div class="mt-auto hidden lg:block">
        <div class="bg-gradient-to-br from-[#1F1F1F] to-[#0A0A0A] p-5 rounded-[1.5rem] border border-white/5 shadow-2xl relative overflow-hidden">
           <div class="flex items-center gap-2 text-[#FFB800] mb-2">
             <i class="fa-solid fa-trophy text-sm"></i>
             <span class="text-[10px] font-black uppercase tracking-[0.15em]">Telkomsel OSIS Race</span>
           </div>
           <p class="text-[11px] text-slate-400 leading-relaxed font-medium">Monitoring Penjualan Sekolah Mitra.</p>
        </div>
      </div>
    </aside>

    <!-- Mobile Sidebar Toggle (Visible on mobile only) -->
    <div class="md:hidden bg-[#0F0F0F] text-white p-4 flex justify-between items-center sticky top-0 z-50">
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 bg-gradient-to-br from-[#EC0000] to-[#800000] rounded-xl flex items-center justify-center">
          <i class="fa-solid fa-rocket text-white"></i>
        </div>
        <h1 class="font-black text-xl">H.E.R.O</h1>
      </div>
      <div class="flex gap-2">
        <button id="mobileDashboard" class="p-2 bg-[#EC0000] rounded-lg text-white">
          <i class="fa-solid fa-chart-pie"></i>
        </button>
        <button id="mobileManagement" class="p-2 bg-white/10 rounded-lg text-white">
          <i class="fa-solid fa-gear"></i>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 p-3 md:p-8 lg:p-12 overflow-y-auto">
      <!-- Header -->
      <header class="mb-8 md:mb-12 flex flex-col lg:flex-row justify-between items-center gap-4 md:gap-6">
        <div class="flex items-center gap-4 md:gap-6">
          <h2 class="text-xl md:text-3xl font-black text-slate-900 tracking-tighter uppercase">Race <span class="text-[#EC0000]">Monitoring</span></h2>
          <div class="flex items-center gap-2 md:gap-3 text-[8px] md:text-[10px] font-black text-slate-400 bg-white px-3 md:px-5 py-1.5 md:py-2.5 rounded-xl md:rounded-2xl border border-slate-200 shadow-sm">
            <i class="fa-regular fa-clock text-[#EC0000] text-xs"></i> UPDATE: <span id="lastUpdated">19:30:45</span>
          </div>
        </div>
        <div class="flex items-center gap-2 md:gap-3">
           <div class="bg-white px-3 md:px-5 py-1.5 md:py-2.5 rounded-xl md:rounded-2xl border border-slate-200 text-[10px] md:text-xs font-bold text-slate-600 shadow-sm flex items-center gap-2">
              <i class="fa-regular fa-calendar text-[#FFB800]"></i> <span id="currentPeriod">Maret 2025</span>
           </div>
           <button id="refreshTimestamp" class="p-2 md:p-3 bg-white border border-slate-200 text-slate-400 hover:text-[#EC0000] rounded-xl md:rounded-2xl transition-all shadow-sm">
              <i class="fa-solid fa-rotate-right"></i>
           </button>
        </div>
      </header>

      <!-- Dashboard View -->
      <div id="dashboardView" class="space-y-10 md:space-y-16 pb-12">
        
        <!-- AI Insight Bar -->
        <section class="bg-white border border-slate-200 p-8 rounded-[2.5rem] shadow-sm relative overflow-hidden group">
           <div class="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity">
              <i class="fa-solid fa-brain text-[#EC0000] text-8xl"></i>
           </div>
           <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 relative z-10">
              <div class="space-y-4 flex-1">
                 <div class="flex items-center gap-3">
                    <div class="p-2 bg-red-50 text-[#EC0000] rounded-xl">
                       <i class="fa-solid fa-sparkles"></i>
                    </div>
                    <h3 class="text-sm font-black uppercase tracking-widest text-slate-800">Analisis Strategi AI</h3>
                 </div>
                 <div id="aiInsightsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- AI Insights will be injected here -->
                    <div class="col-span-3 py-4 flex items-center gap-3 text-slate-400">
                      <i class="fa-solid fa-circle-exclamation"></i>
                      <p class="text-xs font-black uppercase tracking-widest">Klik Refresh AI Analysis untuk memulai.</p>
                    </div>
                 </div>
              </div>
              <button id="refreshAI" class="flex items-center gap-3 px-8 py-5 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all bg-slate-900 text-white hover:bg-black shadow-xl shadow-black/10 hover:scale-105 active:scale-95">
                 <i class="fa-solid fa-brain"></i>
                 Refresh AI Analysis
              </button>
           </div>
        </section>
        
        <!-- PODIUM SECTION -->
        <section>
          <div class="flex items-center justify-between mb-6 md:mb-8">
            <div class="flex items-center gap-2 md:gap-3">
              <div class="p-2 bg-[#FFB800] text-white rounded-lg md:rounded-xl">
                <i class="fa-solid fa-trophy"></i>
              </div>
              <h3 class="text-[10px] md:text-sm font-black text-slate-800 uppercase tracking-widest italic flex items-center gap-2">
                Podium Jawara H.E.R.O <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse ml-2"></span>
              </h3>
            </div>
          </div>

          <div id="podiumContainer" class="grid grid-cols-3 gap-1.5 md:gap-8 items-end px-0.5 md:px-0">
            <!-- Podium will be dynamically populated -->
          </div>
        </section>

        <!-- FULL LEADERBOARD TABLE -->
        <div class="space-y-8">
          <div class="flex items-center gap-4 mb-2">
             <div class="p-2.5 bg-slate-900 text-white rounded-xl">
               <i class="fa-solid fa-school"></i>
             </div>
             <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest italic">Tabel Klasemen Harian</h3>
          </div>

          <div class="bg-white rounded-[2.5rem] shadow-2xl shadow-slate-200/40 border border-slate-100 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-left border-collapse">
                <thead>
                  <tr class="bg-slate-50/50 text-slate-400 text-[10px] uppercase font-black tracking-widest border-b border-slate-100">
                    <th class="px-6 md:px-10 py-6 text-center">No</th>
                    <th class="px-6 md:px-10 py-6">Nama Sekolah</th>
                    <th class="px-6 md:px-10 py-6 text-right">Total Omzet</th>
                    <th class="px-6 md:px-10 py-6 text-center">Trend</th>
                    <th class="px-6 md:px-10 py-6 text-center">Kelas Jawara</th>
                    <th class="px-6 md:px-10 py-6 text-center">Total Qty</th>
                  </tr>
                </thead>
                <tbody id="leaderboardBody" class="divide-y divide-slate-100">
                  <!-- Leaderboard rows will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Top 10 Customers Section -->
        <div class="space-y-8">
          <div class="flex items-center gap-4 mb-2">
             <div class="p-2.5 bg-[#FFB800] text-white rounded-xl">
               <i class="fa-solid fa-star"></i>
             </div>
             <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest italic">TOP 10 CUSTOMER</h3>
          </div>

          <div class="bg-white rounded-[2.5rem] shadow-2xl shadow-slate-200/40 border border-slate-100 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-left border-collapse">
                <thead>
                  <tr class="bg-slate-50/50 text-slate-400 text-[10px] uppercase font-black tracking-widest border-b border-slate-100">
                    <th class="px-6 md:px-10 py-6 text-center">Rank</th>
                    <th class="px-6 md:px-10 py-6">Nama Customer</th>
                    <th class="px-6 md:px-10 py-6">Sekolah</th>
                    <th class="px-6 md:px-10 py-6 text-right">Total Transaksi</th>
                    <th class="px-6 md:px-10 py-6 text-right">Total Belanja</th>
                  </tr>
                </thead>
                <tbody id="topCustomersBody" class="divide-y divide-slate-100">
                  <!-- Top customers will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Competitor Analysis Section -->
        <div class="space-y-8">
          <div class="flex items-center gap-4 mb-2">
             <div class="p-2.5 bg-purple-600 text-white rounded-xl">
               <i class="fa-solid fa-chart-simple"></i>
             </div>
             <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest italic">ANALISIS KOMPETITOR</h3>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-xl">
              <h4 class="font-black text-sm mb-4">Market Share</h4>
              <div id="marketShareContainer" class="space-y-3">
                <!-- Market share will be populated -->
              </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-xl md:col-span-2">
              <h4 class="font-black text-sm mb-4">Perbandingan Performa</h4>
              <div id="competitorComparison" class="space-y-4">
                <!-- Competitor comparison will be populated -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Data Management View (Hidden by default) -->
      <div id="managementView" class="hidden space-y-8">
        <div class="bg-white rounded-[2.5rem] p-8 shadow-xl">
          <h3 class="text-xl font-black mb-6">Data Master</h3>
          
          <!-- Import/Export Section -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Import Excel -->
            <div class="p-6 bg-slate-50 rounded-2xl">
              <h4 class="font-black mb-4 flex items-center gap-2">
                <i class="fa-solid fa-file-excel text-green-600"></i>
                Import Data Excel
              </h4>
              <div class="space-y-4">
                <a href="#" id="downloadTemplate" class="inline-flex items-center gap-2 text-[#EC0000] hover:underline">
                  <i class="fa-solid fa-download"></i> Download Template Excel
                </a>
                <input type="file" id="excelFile" accept=".xlsx,.xls" class="block w-full text-sm border rounded-lg p-2">
                <button id="importExcel" class="bg-[#EC0000] text-white px-6 py-3 rounded-xl font-bold hover:bg-[#cc0000] transition-all w-full">
                  <i class="fa-solid fa-upload"></i> Import Data
                </button>
              </div>
            </div>

            <!-- Export Excel -->
            <div class="p-6 bg-slate-50 rounded-2xl">
              <h4 class="font-black mb-4 flex items-center gap-2">
                <i class="fa-solid fa-file-export text-blue-600"></i>
                Export Data Excel
              </h4>
              <div class="space-y-4">
                <div class="flex gap-2">
                  <input type="date" id="exportStartDate" class="flex-1 p-2 border rounded-lg text-sm">
                  <input type="date" id="exportEndDate" class="flex-1 p-2 border rounded-lg text-sm">
                </div>
                <button id="exportExcel" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all w-full">
                  <i class="fa-solid fa-download"></i> Export Data
                </button>
              </div>
            </div>
          </div>

          <!-- Google Sheet Sync -->
          <div class="mb-8 p-6 bg-slate-50 rounded-2xl">
            <h4 class="font-black mb-4 flex items-center gap-2">
              <i class="fa-brands fa-google text-green-600"></i>
              Sinkronisasi Google Sheet
            </h4>
            <div class="flex gap-2">
              <input type="url" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." class="flex-1 p-3 border rounded-xl">
              <button id="syncButton" class="bg-[#EC0000] text-white px-6 py-3 rounded-xl font-bold hover:bg-[#cc0000] transition-all flex items-center gap-2">
                <i class="fa-solid fa-rotate"></i> Sinkron
              </button>
            </div>
          </div>

          <!-- Header Labels Configuration -->
          <div class="mb-8 p-6 bg-slate-50 rounded-2xl">
            <h4 class="font-black mb-4">Konfigurasi Header Label</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-bold mb-1">Nama Sekolah</label>
                <input type="text" id="headerSchool" value="Nama Sekolah" class="w-full p-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-xs font-bold mb-1">Siswa (Angka)</label>
                <input type="text" id="headerStudent" value="Siswa (Angka)" class="w-full p-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-xs font-bold mb-1">Siswa Terbaik (Teks)</label>
                <input type="text" id="headerTopStudent" value="Siswa Terbaik (Teks)" class="w-full p-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-xs font-bold mb-1">Kelas</label>
                <input type="text" id="headerClass" value="Kelas" class="w-full p-2 border rounded-lg">
              </div>
              <div>
                <label class="block text-xs font-bold mb-1">Revenue (Rp)</label>
                <input type="text" id="headerRevenue" value="Revenue (Rp)" class="w-full p-2 border rounded-lg">
              </div>
            </div>
            <button id="saveHeaders" class="mt-4 bg-slate-900 text-white px-8 py-3 rounded-xl font-bold hover:bg-black transition-all">
              Simpan Perubahan
            </button>
          </div>

          <!-- School Profile Management -->
          <div class="mb-8 p-6 bg-slate-50 rounded-2xl">
            <h4 class="font-black mb-4">Profil Sekolah</h4>
            <div id="schoolsManagementList" class="space-y-4">
              <!-- Will be populated dynamically -->
            </div>
          </div>

          <!-- Top 5 Products Management -->
          <div class="mb-8 p-6 bg-slate-50 rounded-2xl">
            <h4 class="font-black mb-4">Top 5 Produk Paling Laris</h4>
            <div id="topProductsManagement" class="space-y-4">
              <!-- Will be populated dynamically -->
            </div>
          </div>

          <!-- Top Customers Management -->
          <div class="mb-8 p-6 bg-slate-50 rounded-2xl">
            <h4 class="font-black mb-4">Top 10 Customer</h4>
            <div id="topCustomersManagement" class="space-y-4">
              <!-- Will be populated dynamically -->
            </div>
            <button id="addCustomerBtn" class="mt-4 bg-green-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-700 transition-all">
              <i class="fa-solid fa-plus"></i> Tambah Customer
            </button>
          </div>

          <!-- Competitor Info Management -->
          <div class="p-6 bg-slate-50 rounded-2xl">
            <h4 class="font-black mb-4">Info Kompetitor (%)</h4>
            <div id="competitorManagement" class="space-y-4">
              <!-- Will be populated dynamically -->
            </div>
            <button id="saveCompetitor" class="mt-4 bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition-all">
              Simpan Data Kompetitor
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- School Detail Modal -->
  <div id="schoolModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white rounded-[2.5rem] max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-8">
        <div class="flex justify-between items-start mb-6">
          <h3 id="modalSchoolName" class="text-2xl font-black">Nama Sekolah</h3>
          <button id="closeModal" class="p-2 hover:bg-slate-100 rounded-full">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
        
        <div id="modalContent" class="space-y-6">
          <!-- Content will be populated dynamically -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Constants
    const SCHOOLS_DATA = [
      {
        id: "1",
        idDigipos: "SMA001",
        name: "SMA NEGERI 1 MALANG",
        revenue: 125000000,
        prevRevenue: 100000000,
        salesCount: 1250,
        lastSale: "2024-03-15",
        trend: "up",
        region: "Malang",
        topProducts: ["Kuota 10GB", "Pulsa 20k", "Paket Belajar", "Kuota 5GB", "Pulsa 50k"],
        totalTransactions: 1250,
        studentCount: 1200,
        topStudentName: "Budi Santoso",
        teacherCount: 65,
        topClass: "XI IPA 1",
        topActiveStudents: [],
        carrierStats: { telkomsel: 70, indosat: 20, xl: 10 },
        dailySales: []
      },
      {
        id: "2",
        idDigipos: "SMA002",
        name: "SMA KRISTEN 2 SURABAYA",
        revenue: 98000000,
        prevRevenue: 95000000,
        salesCount: 980,
        lastSale: "2024-03-15",
        trend: "up",
        region: "Surabaya",
        topProducts: ["Paket Belajar", "Kuota 10GB", "Pulsa 20k", "Paket Data", "Pulsa 50k"],
        totalTransactions: 980,
        studentCount: 900,
        topStudentName: "Maria Wijaya",
        teacherCount: 55,
        topClass: "XII IPS 2",
        topActiveStudents: [],
        carrierStats: { telkomsel: 60, indosat: 30, xl: 10 },
        dailySales: []
      },
      {
        id: "3",
        idDigipos: "SMA003",
        name: "SMA MUHAMMADIYAH 3 JAKARTA",
        revenue: 87500000,
        prevRevenue: 88000000,
        salesCount: 875,
        lastSale: "2024-03-14",
        trend: "stable",
        region: "Jakarta",
        topProducts: ["Pulsa 50k", "Paket Data", "Kuota 10GB", "Pulsa 20k", "Paket Belajar"],
        totalTransactions: 875,
        studentCount: 1100,
        topStudentName: "Ahmad Fauzi",
        teacherCount: 70,
        topClass: "XI IPA 2",
        topActiveStudents: [],
        carrierStats: { telkomsel: 75, indosat: 15, xl: 10 },
        dailySales: []
      },
      {
        id: "4",
        idDigipos: "SMA004",
        name: "SMA KATOLIK ST. ALBERTUS",
        revenue: 72000000,
        prevRevenue: 75000000,
        salesCount: 720,
        lastSale: "2024-03-13",
        trend: "down",
        region: "Malang",
        topProducts: ["Kuota 5GB", "Pulsa 20k", "Paket Belajar", "Kuota 10GB", "Pulsa 50k"],
        totalTransactions: 720,
        studentCount: 800,
        topStudentName: "Kevin Alexander",
        teacherCount: 48,
        topClass: "X IPA 3",
        topActiveStudents: [],
        carrierStats: { telkomsel: 65, indosat: 25, xl: 10 },
        dailySales: []
      },
      {
        id: "5",
        idDigipos: "SMA005",
        name: "SMA NEGERI 5 BANDUNG",
        revenue: 65000000,
        prevRevenue: 62000000,
        salesCount: 650,
        lastSale: "2024-03-15",
        trend: "up",
        region: "Bandung",
        topProducts: ["Paket Data", "Kuota 10GB", "Pulsa 20k", "Paket Belajar", "Pulsa 50k"],
        totalTransactions: 650,
        studentCount: 950,
        topStudentName: "Rina Wijayanti",
        teacherCount: 62,
        topClass: "XII MIPA 1",
        topActiveStudents: [],
        carrierStats: { telkomsel: 80, indosat: 12, xl: 8 },
        dailySales: []
      }
    ];

    // Top Customers Data
    const TOP_CUSTOMERS_DATA = [
      { rank: 1, name: "Budi Santoso", school: "SMA NEGERI 1 MALANG", transactions: 45, totalSpent: 2250000 },
      { rank: 2, name: "Maria Wijaya", school: "SMA KRISTEN 2 SURABAYA", transactions: 38, totalSpent: 1900000 },
      { rank: 3, name: "Ahmad Fauzi", school: "SMA MUHAMMADIYAH 3 JAKARTA", transactions: 32, totalSpent: 1600000 },
      { rank: 4, name: "Kevin Alexander", school: "SMA KATOLIK ST. ALBERTUS", transactions: 28, totalSpent: 1400000 },
      { rank: 5, name: "Rina Wijayanti", school: "SMA NEGERI 5 BANDUNG", transactions: 25, totalSpent: 1250000 },
      { rank: 6, name: "Dewi Lestari", school: "SMA NEGERI 1 MALANG", transactions: 22, totalSpent: 1100000 },
      { rank: 7, name: "Rudi Hartono", school: "SMA KRISTEN 2 SURABAYA", transactions: 20, totalSpent: 1000000 },
      { rank: 8, name: "Siti Aminah", school: "SMA MUHAMMADIYAH 3 JAKARTA", transactions: 18, totalSpent: 900000 },
      { rank: 9, name: "John Doe", school: "SMA KATOLIK ST. ALBERTUS", transactions: 16, totalSpent: 800000 },
      { rank: 10, name: "Jane Smith", school: "SMA NEGERI 5 BANDUNG", transactions: 15, totalSpent: 750000 }
    ];

    // Competitor Data
    const COMPETITOR_DATA = {
      marketShare: [
        { name: "Telkomsel", share: 45, color: "red" },
        { name: "Indosat", share: 30, color: "yellow" },
        { name: "XL", share: 15, color: "blue" },
        { name: "Tri", share: 10, color: "purple" }
      ],
      performance: [
        { competitor: "Telkomsel", growth: 12, marketLeader: true },
        { competitor: "Indosat", growth: 8, marketLeader: false },
        { competitor: "XL", growth: 5, marketLeader: false },
        { competitor: "Tri", growth: 3, marketLeader: false }
      ]
    };

    // State variables
    let schools = [...SCHOOLS_DATA];
    let topCustomers = [...TOP_CUSTOMERS_DATA];
    let competitorData = {...COMPETITOR_DATA};
    let activeTab = 'dashboard';
    let aiInsights = [];
    let isAiLoading = false;
    let lastUpdated = new Date().toLocaleTimeString('id-ID');
    let selectedSchool = null;
    let headerLabels = {
      schoolName: 'Nama Sekolah',
      studentCount: 'Siswa (Angka)',
      topStudent: 'Siswa Terbaik (Teks)',
      className: 'Kelas',
      revenue: 'Revenue (Rp)'
    };

    // DOM Elements
    const dashboardView = document.getElementById('dashboardView');
    const managementView = document.getElementById('managementView');
    const dashboardTab = document.getElementById('dashboardTab');
    const managementTab = document.getElementById('managementTab');
    const mobileDashboard = document.getElementById('mobileDashboard');
    const mobileManagement = document.getElementById('mobileManagement');
    const refreshTimestamp = document.getElementById('refreshTimestamp');
    const lastUpdatedSpan = document.getElementById('lastUpdated');
    const currentPeriodSpan = document.getElementById('currentPeriod');
    const refreshAI = document.getElementById('refreshAI');
    const aiInsightsContainer = document.getElementById('aiInsightsContainer');
    const podiumContainer = document.getElementById('podiumContainer');
    const leaderboardBody = document.getElementById('leaderboardBody');
    const topCustomersBody = document.getElementById('topCustomersBody');
    const marketShareContainer = document.getElementById('marketShareContainer');
    const competitorComparison = document.getElementById('competitorComparison');
    const schoolModal = document.getElementById('schoolModal');
    const closeModal = document.getElementById('closeModal');
    const syncButton = document.getElementById('syncButton');
    const sheetUrl = document.getElementById('sheetUrl');
    const saveHeaders = document.getElementById('saveHeaders');
    const schoolsManagementList = document.getElementById('schoolsManagementList');
    const topProductsManagement = document.getElementById('topProductsManagement');
    const topCustomersManagement = document.getElementById('topCustomersManagement');
    const competitorManagement = document.getElementById('competitorManagement');
    const downloadTemplate = document.getElementById('downloadTemplate');
    const importExcel = document.getElementById('importExcel');
    const excelFile = document.getElementById('excelFile');
    const exportExcel = document.getElementById('exportExcel');
    const exportStartDate = document.getElementById('exportStartDate');
    const exportEndDate = document.getElementById('exportEndDate');
    const addCustomerBtn = document.getElementById('addCustomerBtn');
    const saveCompetitor = document.getElementById('saveCompetitor');

    // Header input elements
    const headerSchool = document.getElementById('headerSchool');
    const headerStudent = document.getElementById('headerStudent');
    const headerTopStudent = document.getElementById('headerTopStudent');
    const headerClass = document.getElementById('headerClass');
    const headerRevenue = document.getElementById('headerRevenue');

    // Initialize header inputs
    headerSchool.value = headerLabels.schoolName;
    headerStudent.value = headerLabels.studentCount;
    headerTopStudent.value = headerLabels.topStudent;
    headerClass.value = headerLabels.className;
    headerRevenue.value = headerLabels.revenue;

    // Helper Functions
    function formatCurrency(amount) {
      return new Intl.NumberFormat('id-ID').format(amount);
    }

    function updateLastUpdated() {
      lastUpdated = new Date().toLocaleTimeString('id-ID');
      lastUpdatedSpan.textContent = lastUpdated;
    }

    function getCurrentPeriod() {
      const date = new Date();
      return new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(date);
    }

    // Set current period
    currentPeriodSpan.textContent = getCurrentPeriod();

    // Sort schools by revenue
    function getSortedSchools() {
      return [...schools].sort((a, b) => b.revenue - a.revenue);
    }

    // Get top 3 schools
    function getTopThree() {
      const sorted = getSortedSchools();
      return sorted.slice(0, 3);
    }

    // Render Podium
    function renderPodium() {
      const topThree = getTopThree();
      let html = '';

      // Default podium if less than 3 schools
      while (topThree.length < 3) {
        topThree.push({
          id: `empty-${topThree.length}`,
          name: '-',
          region: '-',
          revenue: 0
        });
      }

      // Silver (2nd)
      if (topThree[1]) {
        html += `
          <div onclick="openSchoolModal('${topThree[1].id}')" class="bg-white border-b-2 md:border-b-4 border-slate-300 p-2 md:p-8 rounded-xl md:rounded-[2.5rem] shadow-lg md:shadow-xl hover:-translate-y-2 transition-all cursor-pointer group relative overflow-hidden">
            <div class="absolute top-0 right-0 p-2 md:p-6 opacity-5 md:opacity-10 group-hover:opacity-20 transition-opacity">
              <i class="fa-solid fa-trophy text-4xl md:text-7xl text-slate-400"></i>
            </div>
            <div class="w-6 h-6 md:w-14 md:h-14 bg-slate-100 rounded-lg md:rounded-2xl flex items-center justify-center text-slate-400 font-black text-[10px] md:text-xl mb-2 md:mb-6 border border-slate-200">2</div>
            <h4 class="text-[8px] md:text-xl font-black text-slate-800 leading-tight mb-1 md:mb-2 uppercase group-hover:text-[#EC0000] transition-colors truncate">${topThree[1].name}</h4>
            <p class="text-[6px] md:text-xs font-bold text-slate-400 mb-2 md:mb-6 truncate">${topThree[1].region}</p>
            <div class="pt-2 md:pt-6 border-t border-slate-50 flex justify-between items-end">
              <div class="flex-1 min-w-0">
                <p class="text-[5px] md:text-[10px] font-black text-slate-400 uppercase tracking-widest mb-0.5 md:mb-1">Realtime Revenue</p>
                <p class="text-[8px] md:text-lg font-black text-slate-900 truncate">Rp${formatCurrency(topThree[1].revenue)}</p>
              </div>
              <i class="fa-solid fa-chevron-right text-slate-200 group-hover:text-[#EC0000] transform group-hover:translate-x-1 transition-all text-xs md:text-base"></i>
            </div>
          </div>
        `;
      }

      // Gold (1st)
      html += `
        <div onclick="openSchoolModal('${topThree[0].id}')" class="bg-gradient-to-br from-[#121212] to-[#000000] p-3 md:p-10 rounded-2xl md:rounded-[3rem] shadow-2xl hover:-translate-y-4 transition-all cursor-pointer group relative overflow-hidden z-10 scale-105 border-b-4 md:border-b-8 border-[#FFB800]">
          <div class="absolute top-0 right-0 p-3 md:p-8 text-[#FFB800] opacity-10 md:opacity-20">
            <i class="fa-solid fa-crown text-5xl md:text-8xl"></i>
          </div>
          <div class="w-8 h-8 md:w-16 md:h-16 bg-[#FFB800] rounded-lg md:rounded-2xl flex items-center justify-center text-white font-black text-xs md:text-2xl mb-3 md:mb-8 shadow-lg shadow-yellow-500/30 relative">
            <i class="fa-solid fa-trophy text-white text-sm md:text-2xl"></i>
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-[#EC0000] rounded-full border-2 border-black animate-ping"></div>
          </div>
          <h4 class="text-[10px] md:text-2xl font-black text-white leading-tight mb-1 md:mb-3 uppercase tracking-tighter truncate">${topThree[0].name}</h4>
          <p class="text-[7px] md:text-sm font-bold text-slate-400 mb-3 md:mb-8 truncate">${topThree[0].region}</p>
          <div class="pt-3 md:pt-8 border-t border-white/10 flex justify-between items-end">
            <div class="overflow-hidden flex-1">
              <p class="text-[5px] md:text-[10px] font-black text-[#FFB800] uppercase tracking-widest mb-0.5 md:mb-1">Leader Revenue (Live)</p>
              <p class="text-[10px] md:text-2xl font-black text-white tracking-tighter truncate">Rp${formatCurrency(topThree[0].revenue)}</p>
            </div>
            <div class="bg-[#EC0000] p-1 md:p-3 rounded-md md:rounded-2xl text-white shadow-lg shrink-0 ml-2">
              <i class="fa-solid fa-sparkles text-xs md:text-base"></i>
            </div>
          </div>
        </div>
      `;

      // Bronze (3rd)
      if (topThree[2]) {
        html += `
          <div onclick="openSchoolModal('${topThree[2].id}')" class="bg-white border-b-2 md:border-b-4 border-amber-600 p-2 md:p-8 rounded-xl md:rounded-[2.5rem] shadow-lg md:shadow-xl hover:-translate-y-2 transition-all cursor-pointer group relative overflow-hidden">
            <div class="absolute top-0 right-0 p-2 md:p-6 opacity-5 md:opacity-10">
              <i class="fa-solid fa-trophy text-4xl md:text-7xl text-amber-700"></i>
            </div>
            <div class="w-6 h-6 md:w-14 md:h-14 bg-amber-50 rounded-lg md:rounded-2xl flex items-center justify-center text-amber-700 font-black text-[10px] md:text-xl mb-2 md:mb-6 border border-amber-100">3</div>
            <h4 class="text-[8px] md:text-xl font-black text-slate-800 leading-tight mb-1 md:mb-2 uppercase group-hover:text-[#EC0000] transition-colors truncate">${topThree[2].name}</h4>
            <p class="text-[6px] md:text-xs font-bold text-slate-400 mb-2 md:mb-6 truncate">${topThree[2].region}</p>
            <div class="pt-2 md:pt-6 border-t border-slate-50 flex justify-between items-end">
              <div class="flex-1 min-w-0">
                <p class="text-[5px] md:text-[10px] font-black text-slate-400 uppercase tracking-widest mb-0.5 md:mb-1">Realtime Revenue</p>
                <p class="text-[8px] md:text-lg font-black text-slate-900 truncate">Rp${formatCurrency(topThree[2].revenue)}</p>
              </div>
              <i class="fa-solid fa-chevron-right text-slate-200 group-hover:text-[#EC0000] transform group-hover:translate-x-1 transition-all text-xs md:text-base"></i>
            </div>
          </div>
        `;
      }

      podiumContainer.innerHTML = html;
    }

    // Render Leaderboard Table
    function renderLeaderboard() {
      const sorted = getSortedSchools();
      let html = '';

      sorted.forEach((school, index) => {
        const trendIcon = school.trend === 'up' 
          ? '<i class="fa-solid fa-trend-up"></i>' 
          : school.trend === 'down' 
            ? '<i class="fa-solid fa-trend-down"></i>' 
            : '<i class="fa-solid fa-minus"></i>';
        
        const trendClass = school.trend === 'up' 
          ? 'text-emerald-600 bg-emerald-50' 
          : school.trend === 'down' 
            ? 'text-red-600 bg-red-50' 
            : 'text-slate-400 bg-slate-50';

        html += `
          <tr onclick="openSchoolModal('${school.id}')" class="hover:bg-slate-50 transition-all group cursor-pointer">
            <td class="px-6 md:px-10 py-6 text-center">
              <span class="text-sm font-black text-slate-300 group-hover:text-[#EC0000] transition-colors">${index + 1}</span>
            </td>
            <td class="px-6 md:px-10 py-6">
              <p class="font-black text-slate-800 text-xs md:text-base group-hover:text-[#EC0000] transition-colors uppercase tracking-tighter truncate max-w-[120px] md:max-w-none">${school.name}</p>
              <p class="text-[8px] text-slate-400 font-bold uppercase">${school.region} â€¢ ${school.idDigipos}</p>
            </td>
            <td class="px-6 md:px-10 py-6 text-right">
              <p class="font-mono font-black text-slate-900 text-xs md:text-base">Rp${formatCurrency(school.revenue)}</p>
              <p class="text-[9px] text-[#EC0000] font-black uppercase tracking-widest">${school.salesCount} ITEMS SOLD</p>
            </td>
            <td class="px-6 md:px-10 py-6 text-center">
               <div class="inline-flex items-center gap-1 ${trendClass} px-3 py-1 rounded-full text-[10px] font-black border uppercase">
                  ${trendIcon} ${school.trend === 'up' ? 'Naik' : school.trend === 'down' ? 'Turun' : 'Stable'}
               </div>
            </td>
            <td class="px-6 md:px-10 py-6 text-center">
              <p class="font-bold text-xs">${school.topClass}</p>
            </td>
            <td class="px-6 md:px-10 py-6 text-center">
              <p class="font-bold text-xs">${school.salesCount}</p>
            </td>
          </tr>
        `;
      });

      leaderboardBody.innerHTML = html;
    }

    // Render Top Customers
    function renderTopCustomers() {
      let html = '';
      topCustomers.forEach(customer => {
        html += `
          <tr class="hover:bg-slate-50 transition-all">
            <td class="px-6 md:px-10 py-6 text-center font-black">#${customer.rank}</td>
            <td class="px-6 md:px-10 py-6 font-bold">${customer.name}</td>
            <td class="px-6 md:px-10 py-6">${customer.school}</td>
            <td class="px-6 md:px-10 py-6 text-right font-bold">${customer.transactions}x</td>
            <td class="px-6 md:px-10 py-6 text-right font-bold text-[#EC0000]">Rp${formatCurrency(customer.totalSpent)}</td>
          </tr>
        `;
      });
      topCustomersBody.innerHTML = html;
    }

    // Render Competitor Analysis
    function renderCompetitorAnalysis() {
      // Market Share
      let marketShareHtml = '';
      competitorData.marketShare.forEach(item => {
        marketShareHtml += `
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="font-bold">${item.name}</span>
              <span class="font-black">${item.share}%</span>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-2">
              <div class="bg-${item.color}-600 h-2 rounded-full" style="width: ${item.share}%"></div>
            </div>
          </div>
        `;
      });
      marketShareContainer.innerHTML = marketShareHtml;

      // Competitor Comparison
      let comparisonHtml = '';
      competitorData.performance.forEach(item => {
        comparisonHtml += `
          <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
            <div class="flex items-center gap-2">
              <span class="font-black">${item.competitor}</span>
              ${item.marketLeader ? '<span class="text-[10px] bg-[#FFB800] text-white px-2 py-0.5 rounded-full">Leader</span>' : ''}
            </div>
            <div class="flex items-center gap-4">
              <span class="text-sm ${item.growth > 0 ? 'text-emerald-600' : 'text-red-600'}">
                <i class="fa-solid fa-${item.growth > 0 ? 'arrow-up' : 'arrow-down'}"></i>
                ${Math.abs(item.growth)}% growth
              </span>
            </div>
          </div>
        `;
      });
      competitorComparison.innerHTML = comparisonHtml;
    }

    // Render Schools Management List
    function renderSchoolsManagement() {
      let html = '';
      schools.forEach((school, index) => {
        html += `
          <div class="bg-white p-4 rounded-xl border border-slate-200">
            <div class="flex justify-between items-start mb-3">
              <div>
                <p class="font-black text-lg">${school.name}</p>
                <p class="text-xs text-slate-500">ID Digipos: ${school.idDigipos}</p>
              </div>
              <button onclick="editSchool('${school.id}')" class="text-[#EC0000] hover:text-[#cc0000]">
                <i class="fa-solid fa-edit text-xl"></i>
              </button>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
              <div class="bg-slate-50 p-2 rounded-lg">
                <p class="text-[10px] text-slate-500">Jumlah Siswa</p>
                <p class="font-black">${school.studentCount}</p>
              </div>
              <div class="bg-slate-50 p-2 rounded-lg">
                <p class="text-[10px] text-slate-500">Wilayah</p>
                <p class="font-black">${school.region}</p>
              </div>
              <div class="bg-slate-50 p-2 rounded-lg">
                <p class="text-[10px] text-slate-500">Kelas Jawara</p>
                <p class="font-black">${school.topClass}</p>
              </div>
              <div class="bg-slate-50 p-2 rounded-lg">
                <p class="text-[10px] text-slate-500">Revenue</p>
                <p class="font-black text-[#EC0000]">Rp${formatCurrency(school.revenue)}</p>
              </div>
              <div class="bg-slate-50 p-2 rounded-lg">
                <p class="text-[10px] text-slate-500">Total Qty</p>
                <p class="font-black">${school.salesCount}</p>
              </div>
            </div>

            <div class="mt-3 grid grid-cols-2 gap-2">
              <div>
                <label class="text-xs font-bold">Edit Kelas Jawara</label>
                <input type="text" id="class-${school.id}" value="${school.topClass}" class="w-full text-sm p-2 border rounded-lg mt-1">
              </div>
              <div>
                <label class="text-xs font-bold">Edit Total Qty</label>
                <input type="number" id="qty-${school.id}" value="${school.salesCount}" class="w-full text-sm p-2 border rounded-lg mt-1">
              </div>
            </div>
            <button onclick="updateSchoolData('${school.id}')" class="mt-3 bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-bold w-full">
              Update Data Sekolah
            </button>
          </div>
        `;
      });
      schoolsManagementList.innerHTML = html;
    }

    // Render Top Products Management
    function renderTopProductsManagement() {
      let html = '';
      schools.forEach((school, schoolIndex) => {
        html += `
          <div class="bg-white p-4 rounded-xl border border-slate-200 mb-4">
            <p class="font-black mb-3">${school.name}</p>
            <div class="space-y-2">
        `;
        
        // Show 5 product inputs
        for (let i = 0; i < 5; i++) {
          const productName = school.topProducts[i] || '';
          html += `
            <div class="flex gap-2">
              <span class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold">${i+1}</span>
              <input type="text" id="product-${school.id}-${i}" value="${productName}" placeholder="Nama Produk ${i+1}" class="flex-1 p-2 border rounded-lg text-sm">
            </div>
          `;
        }
        
        html += `
            </div>
            <button onclick="updateTopProducts('${school.id}')" class="mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold w-full">
              Simpan Top 5 Produk
            </button>
          </div>
        `;
      });
      topProductsManagement.innerHTML = html;
    }

    // Update Top Products
    window.updateTopProducts = function(schoolId) {
      const school = schools.find(s => s.id === schoolId);
      if (school) {
        const products = [];
        for (let i = 0; i < 5; i++) {
          const input = document.getElementById(`product-${schoolId}-${i}`);
          if (input && input.value.trim()) {
            products.push(input.value.trim());
          }
        }
        school.topProducts = products;
        updateLastUpdated();
        alert('Top 5 produk berhasil disimpan!');
      }
    };

    // Update School Data
    window.updateSchoolData = function(schoolId) {
      const school = schools.find(s => s.id === schoolId);
      if (school) {
        const classInput = document.getElementById(`class-${schoolId}`);
        const qtyInput = document.getElementById(`qty-${schoolId}`);
        
        if (classInput) school.topClass = classInput.value;
        if (qtyInput) school.salesCount = parseInt(qtyInput.value) || 0;
        
        renderSchoolsManagement();
        renderLeaderboard();
        renderPodium();
        updateLastUpdated();
        alert('Data sekolah berhasil diupdate!');
      }
    };

    // Render Top Customers Management
    function renderTopCustomersManagement() {
      let html = '';
      topCustomers.forEach((customer, index) => {
        html += `
          <div class="bg-white p-4 rounded-xl border border-slate-200">
            <div class="flex justify-between items-center">
              <div class="flex items-center gap-3">
                <span class="w-8 h-8 bg-[#FFB800] text-white rounded-full flex items-center justify-center font-black">${customer.rank}</span>
                <div>
                  <p class="font-black">${customer.name}</p>
                  <p class="text-xs text-slate-500">${customer.school}</p>
                </div>
              </div>
              <div class="flex gap-2">
                <button onclick="editCustomer(${index})" class="text-blue-600 hover:text-blue-800">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button onclick="deleteCustomer(${index})" class="text-red-600 hover:text-red-800">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <div class="bg-slate-50 p-2 rounded-lg">
                <p class="text-[10px] text-slate-500">Transaksi</p>
                <p class="font-black">${customer.transactions}x</p>
              </div>
              <div class="bg-slate-50 p-2 rounded-lg">
                <p class="text-[10px] text-slate-500">Total Belanja</p>
                <p class="font-black text-[#EC0000]">Rp${formatCurrency(customer.totalSpent)}</p>
              </div>
            </div>
            <div class="mt-2 grid grid-cols-2 gap-2">
              <input type="text" id="customer-name-${index}" value="${customer.name}" placeholder="Nama" class="text-sm p-2 border rounded-lg">
              <input type="text" id="customer-school-${index}" value="${customer.school}" placeholder="Sekolah" class="text-sm p-2 border rounded-lg">
              <input type="number" id="customer-trans-${index}" value="${customer.transactions}" placeholder="Transaksi" class="text-sm p-2 border rounded-lg">
              <input type="number" id="customer-spent-${index}" value="${customer.totalSpent}" placeholder="Total Belanja" class="text-sm p-2 border rounded-lg">
            </div>
            <button onclick="updateCustomer(${index})" class="mt-2 bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold w-full">
              Update Customer
            </button>
          </div>
        `;
      });
      topCustomersManagement.innerHTML = html;
    }

    // Update Customer
    window.updateCustomer = function(index) {
      const customer = topCustomers[index];
      const nameInput = document.getElementById(`customer-name-${index}`);
      const schoolInput = document.getElementById(`customer-school-${index}`);
      const transInput = document.getElementById(`customer-trans-${index}`);
      const spentInput = document.getElementById(`customer-spent-${index}`);
      
      if (nameInput) customer.name = nameInput.value;
      if (schoolInput) customer.school = schoolInput.value;
      if (transInput) customer.transactions = parseInt(transInput.value) || 0;
      if (spentInput) customer.totalSpent = parseInt(spentInput.value) || 0;
      
      renderTopCustomersManagement();
      renderTopCustomers();
      updateLastUpdated();
    };

    // Render Competitor Management
    function renderCompetitorManagement() {
      let html = '<div class="space-y-4">';
      
      // Market Share
      html += '<div><h5 class="font-bold mb-2">Market Share (%)</h5>';
      competitorData.marketShare.forEach((item, index) => {
        html += `
          <div class="flex items-center gap-2 mb-2">
            <span class="w-20 text-sm">${item.name}</span>
            <input type="number" id="market-share-${index}" value="${item.share}" min="0" max="100" class="w-20 p-2 border rounded-lg text-center">
            <span class="text-sm">%</span>
          </div>
        `;
      });
      html += '</div>';

      // Performance
      html += '<div class="mt-4"><h5 class="font-bold mb-2">Growth (%)</h5>';
      competitorData.performance.forEach((item, index) => {
        html += `
          <div class="flex items-center gap-2 mb-2">
            <span class="w-20 text-sm">${item.competitor}</span>
            <input type="number" id="growth-${index}" value="${item.growth}" min="-100" max="100" class="w-20 p-2 border rounded-lg text-center">
            <span class="text-sm">%</span>
          </div>
        `;
      });
      html += '</div></div>';

      competitorManagement.innerHTML = html;
    }

    // Open School Modal with Complete Data
    window.openSchoolModal = function(schoolId) {
      const school = schools.find(s => s.id === schoolId);
      if (!school) return;

      selectedSchool = school;
      document.getElementById('modalSchoolName').textContent = school.name;
      
      // Get school-specific top customers
      const schoolCustomers = topCustomers.filter(c => c.school === school.name).slice(0, 10);
      
      // Get competitor data for this school (simulasi)
      const schoolCompetitor = {
        marketShare: competitorData.marketShare,
        performance: competitorData.performance
      };

      const modalContent = document.getElementById('modalContent');
      
      // Build products list
      let productsHtml = '';
      if (school.topProducts && school.topProducts.length > 0) {
        school.topProducts.forEach((product, idx) => {
          productsHtml += `
            <div class="flex items-center gap-2 p-2 bg-slate-50 rounded-lg">
              <span class="w-6 h-6 bg-[#EC0000] text-white rounded-full flex items-center justify-center text-xs font-black">${idx + 1}</span>
              <span class="font-bold">${product}</span>
            </div>
          `;
        });
      } else {
        productsHtml = '<p class="text-slate-400">Belum ada data produk</p>';
      }

      // Build customers list
      let customersHtml = '';
      if (schoolCustomers.length > 0) {
        schoolCustomers.forEach((customer, idx) => {
          customersHtml += `
            <div class="flex items-center justify-between p-2 bg-slate-50 rounded-lg">
              <div class="flex items-center gap-2">
                <span class="w-6 h-6 bg-[#FFB800] text-white rounded-full flex items-center justify-center text-xs font-black">${idx + 1}</span>
                <span class="font-bold">${customer.name}</span>
              </div>
              <div class="text-right">
                <p class="text-xs">${customer.transactions}x transaksi</p>
                <p class="text-xs font-bold text-[#EC0000]">Rp${formatCurrency(customer.totalSpent)}</p>
              </div>
            </div>
          `;
        });
      } else {
        customersHtml = '<p class="text-slate-400">Belum ada data customer</p>';
      }

      // Build competitor info
      let competitorHtml = '';
      schoolCompetitor.marketShare.forEach(item => {
        competitorHtml += `
          <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
            <span class="font-bold">${item.name}</span>
            <span class="font-black">${item.share}%</span>
          </div>
        `;
      });

      modalContent.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Left Column -->
          <div class="space-y-4">
            <!-- Basic Info -->
            <div class="bg-slate-50 p-4 rounded-xl">
              <h4 class="font-black text-sm mb-3 text-[#EC0000]">INFORMASI DASAR</h4>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-slate-600">ID Digipos:</span>
                  <span class="font-bold">${school.idDigipos}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-slate-600">Wilayah:</span>
                  <span class="font-bold">${school.region}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-slate-600">Kelas Jawara:</span>
                  <span class="font-bold text-[#FFB800]">${school.topClass}</span>
                </div>
              </div>
            </div>

            <!-- Stats -->
            <div class="bg-slate-50 p-4 rounded-xl">
              <h4 class="font-black text-sm mb-3 text-[#EC0000]">STATISTIK</h4>
              <div class="grid grid-cols-2 gap-3">
                <div class="bg-white p-3 rounded-lg">
                  <p class="text-xs text-slate-500">Jumlah Siswa</p>
                  <p class="font-black text-lg">${school.studentCount}</p>
                </div>
                <div class="bg-white p-3 rounded-lg">
                  <p class="text-xs text-slate-500">Total Qty</p>
                  <p class="font-black text-lg">${school.salesCount}</p>
                </div>
                <div class="bg-white p-3 rounded-lg col-span-2">
                  <p class="text-xs text-slate-500">Total Revenue/Omset</p>
                  <p class="font-black text-2xl text-[#EC0000]">Rp${formatCurrency(school.revenue)}</p>
                </div>
              </div>
            </div>

            <!-- Info Kompetitor -->
            <div class="bg-slate-50 p-4 rounded-xl">
              <h4 class="font-black text-sm mb-3 text-[#EC0000]">INFO KOMPETITOR</h4>
              <div class="space-y-2">
                ${competitorHtml}
              </div>
              <div class="mt-3 pt-3 border-t border-slate-200">
                <p class="text-xs font-bold mb-2">Growth Rate:</p>
                ${schoolCompetitor.performance.map(p => `
                  <div class="flex justify-between text-sm">
                    <span>${p.competitor}</span>
                    <span class="${p.growth > 0 ? 'text-emerald-600' : 'text-red-600'}">
                      ${p.growth > 0 ? '+' : ''}${p.growth}%
                    </span>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div class="space-y-4">
            <!-- Top 5 Products -->
            <div class="bg-slate-50 p-4 rounded-xl">
              <h4 class="font-black text-sm mb-3 text-[#EC0000]">TOP 5 PRODUK PALING LARIS</h4>
              <div class="space-y-2">
                ${productsHtml}
              </div>
            </div>

            <!-- Top 10 Customers -->
            <div class="bg-slate-50 p-4 rounded-xl">
              <h4 class="font-black text-sm mb-3 text-[#EC0000]">TOP 10 CUSTOMER</h4>
              <div class="space-y-2 max-h-60 overflow-y-auto">
                ${customersHtml}
              </div>
            </div>
          </div>
        </div>
      `;
      
      schoolModal.classList.remove('hidden');
    };

    // Close Modal
    closeModal.addEventListener('click', () => {
      schoolModal.classList.add('hidden');
      selectedSchool = null;
    });

    // Click outside to close
    schoolModal.addEventListener('click', (e) => {
      if (e.target === schoolModal) {
        schoolModal.classList.add('hidden');
        selectedSchool = null;
      }
    });

    // Download Excel Template
    downloadTemplate.addEventListener('click', (e) => {
      e.preventDefault();
      
      // Create template data
      const templateData = [
        ['ID Digipos', 'Nama Sekolah', 'Wilayah', 'Jumlah Siswa', 'Jumlah Guru', 'Kelas Jawara', 'Revenue', 'Prev Revenue', 'Trend (up/down/stable)', 'Total Qty'],
        ['SMA001', 'SMA NEGERI 1 MALANG', 'Malang', '1200', '65', 'XI IPA 1', '125000000', '100000000', 'up', '1250'],
        ['SMA002', 'SMA KRISTEN 2 SURABAYA', 'Surabaya', '900', '55', 'XII IPS 2', '98000000', '95000000', 'up', '980'],
        ['', '', '', '', '', '', '', '', '', '']
      ];

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(templateData);
      
      // Add column widths
      ws['!cols'] = [
        { wch: 15 }, // ID Digipos
        { wch: 30 }, // Nama Sekolah
        { wch: 15 }, // Wilayah
        { wch: 15 }, // Jumlah Siswa
        { wch: 15 }, // Jumlah Guru
        { wch: 15 }, // Kelas Jawara
        { wch: 20 }, // Revenue
        { wch: 20 }, // Prev Revenue
        { wch: 15 }, // Trend
        { wch: 15 }  // Total Qty
      ];

      XLSX.utils.book_append_sheet(wb, ws, 'Template Sekolah');
      
      // Add Top Products sheet
      const productsSheet = [
        ['ID Digipos', 'Produk 1', 'Produk 2', 'Produk 3', 'Produk 4', 'Produk 5'],
        ['SMA001', 'Kuota 10GB', 'Pulsa 20k', 'Paket Belajar', 'Kuota 5GB', 'Pulsa 50k'],
        ['SMA002', 'Paket Belajar', 'Kuota 10GB', 'Pulsa 20k', 'Paket Data', 'Pulsa 50k'],
        ['', '', '', '', '', '']
      ];
      const ws2 = XLSX.utils.aoa_to_sheet(productsSheet);
      XLSX.utils.book_append_sheet(wb, ws2, 'Top Products');

      // Add Top Customers sheet
      const customerSheet = [
        ['Rank', 'Nama Customer', 'Sekolah', 'Jumlah Transaksi', 'Total Belanja'],
        ['1', 'Budi Santoso', 'SMA NEGERI 1 MALANG', '45', '2250000'],
        ['2', 'Maria Wijaya', 'SMA KRISTEN 2 SURABAYA', '38', '1900000'],
        ['', '', '', '', '']
      ];
      const ws3 = XLSX.utils.aoa_to_sheet(customerSheet);
      XLSX.utils.book_append_sheet(wb, ws3, 'Top Customers');

      XLSX.writeFile(wb, 'hero_dashboard_template.xlsx');
    });

    // Import Excel
    importExcel.addEventListener('click', () => {
      const file = excelFile.files[0];
      if (!file) {
        alert('Pilih file Excel terlebih dahulu');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          
          // Import Schools
          const schoolSheet = workbook.Sheets[workbook.SheetNames[0]];
          const schoolData = XLSX.utils.sheet_to_json(schoolSheet, { header: 1 });
          
          // Skip header row
          const newSchools = [];
          for (let i = 1; i < schoolData.length; i++) {
            const row = schoolData[i];
            if (row[0] && row[1]) { // Has ID and Name
              newSchools.push({
                id: String(i),
                idDigipos: row[0] || '',
                name: row[1] || '',
                region: row[2] || 'Malang',
                studentCount: Number(row[3]) || 0,
                teacherCount: Number(row[4]) || 0,
                topClass: row[5] || '-',
                revenue: Number(row[6]) || 0,
                prevRevenue: Number(row[7]) || 0,
                trend: (row[8] || 'stable').toLowerCase(),
                salesCount: Number(row[9]) || 0,
                lastSale: '-',
                topProducts: [],
                totalTransactions: Number(row[9]) || 0,
                topStudentName: '-',
                topActiveStudents: [],
                carrierStats: { telkomsel: 70, indosat: 20, xl: 10 },
                dailySales: []
              });
            }
          }

          if (newSchools.length > 0) {
            schools = newSchools;
            
            // Import Top Products if available
            if (workbook.SheetNames.length > 1) {
              const productsSheet = workbook.Sheets[workbook.SheetNames[1]];
              const productsData = XLSX.utils.sheet_to_json(productsSheet, { header: 1 });
              
              for (let i = 1; i < productsData.length; i++) {
                const row = productsData[i];
                if (row[0]) {
                  const school = schools.find(s => s.idDigipos === row[0]);
                  if (school) {
                    school.topProducts = [
                      row[1] || '',
                      row[2] || '',
                      row[3] || '',
                      row[4] || '',
                      row[5] || ''
                    ].filter(p => p);
                  }
                }
              }
            }
            
            // Import Top Customers if available
            if (workbook.SheetNames.length > 2) {
              const customerSheet = workbook.Sheets[workbook.SheetNames[2]];
              const customerData = XLSX.utils.sheet_to_json(customerSheet, { header: 1 });
              
              const newCustomers = [];
              for (let i = 1; i < customerData.length; i++) {
                const row = customerData[i];
                if (row[1]) { // Has customer name
                  newCustomers.push({
                    rank: Number(row[0]) || i,
                    name: row[1] || '',
                    school: row[2] || '',
                    transactions: Number(row[3]) || 0,
                    totalSpent: Number(row[4]) || 0
                  });
                }
              }
              
              if (newCustomers.length > 0) {
                topCustomers = newCustomers;
              }
            }
            
            // Update all views
            renderPodium();
            renderLeaderboard();
            renderTopCustomers();
            renderCompetitorAnalysis();
            renderSchoolsManagement();
            renderTopProductsManagement();
            renderTopCustomersManagement();
            updateLastUpdated();
            
            alert('Import data berhasil!');
          }
        } catch (error) {
          console.error('Import error:', error);
          alert('Gagal mengimpor data. Periksa format file Anda.');
        }
      };
      reader.readAsArrayBuffer(file);
    });

    // Export Excel
    exportExcel.addEventListener('click', () => {
      const startDate = exportStartDate.value;
      const endDate = exportEndDate.value;
      
      // Filter data based on date range (simplified for demo)
      const exportData = [
        ['Laporan Data Penjualan H.E.R.O'],
        [`Periode: ${startDate || 'Semua'} - ${endDate || 'Semua'}`],
        [''],
        ['Rank', 'Nama Sekolah', 'ID Digipos', 'Wilayah', 'Revenue', 'Total Qty', 'Jumlah Siswa', 'Kelas Jawara', 'Trend']
      ];

      const sorted = getSortedSchools();
      sorted.forEach((school, index) => {
        exportData.push([
          index + 1,
          school.name,
          school.idDigipos,
          school.region,
          school.revenue,
          school.salesCount,
          school.studentCount,
          school.topClass,
          school.trend
        ]);
      });

      // Add Top Products
      exportData.push([''], ['TOP 5 PRODUK PER SEKOLAH']);
      schools.forEach(school => {
        exportData.push([`${school.name}`]);
        if (school.topProducts && school.topProducts.length > 0) {
          school.topProducts.forEach((product, idx) => {
            exportData.push([`  ${idx+1}. ${product}`]);
          });
        } else {
          exportData.push(['  Belum ada data']);
        }
        exportData.push(['']);
      });

      // Add Top Customers
      exportData.push([''], ['TOP 10 CUSTOMER'], ['Rank', 'Nama Customer', 'Sekolah', 'Transaksi', 'Total Belanja']);
      topCustomers.forEach(customer => {
        exportData.push([
          customer.rank,
          customer.name,
          customer.school,
          customer.transactions,
          customer.totalSpent
        ]);
      });

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(exportData);
      XLSX.utils.book_append_sheet(wb, ws, 'Laporan H.E.R.O');
      
      const filename = `hero_report_${startDate || 'all'}_to_${endDate || 'all'}.xlsx`;
      XLSX.writeFile(wb, filename);
    });

    // Edit School (placeholder)
    window.editSchool = function(schoolId) {
      const school = schools.find(s => s.id === schoolId);
      if (school) {
        const newName = prompt('Edit Nama Sekolah:', school.name);
        if (newName) {
          school.name = newName;
          renderSchoolsManagement();
          renderPodium();
          renderLeaderboard();
          updateLastUpdated();
        }
      }
    };

    // Customer Management
    window.editCustomer = function(index) {
      const customer = topCustomers[index];
      const newName = prompt('Edit Nama Customer:', customer.name);
      if (newName) {
        customer.name = newName;
        renderTopCustomersManagement();
        renderTopCustomers();
        updateLastUpdated();
      }
    };

    window.deleteCustomer = function(index) {
      if (confirm('Hapus customer ini?')) {
        topCustomers.splice(index, 1);
        // Re-rank
        topCustomers.forEach((c, i) => c.rank = i + 1);
        renderTopCustomersManagement();
        renderTopCustomers();
        updateLastUpdated();
      }
    };

    // Add Customer
    addCustomerBtn.addEventListener('click', () => {
      const newCustomer = {
        rank: topCustomers.length + 1,
        name: 'Customer Baru',
        school: 'SMA NEGERI 1 MALANG',
        transactions: 0,
        totalSpent: 0
      };
      topCustomers.push(newCustomer);
      renderTopCustomersManagement();
      renderTopCustomers();
    });

    // Save Competitor Data
    saveCompetitor.addEventListener('click', () => {
      // Update market share
      competitorData.marketShare.forEach((item, index) => {
        const input = document.getElementById(`market-share-${index}`);
        if (input) {
          item.share = Number(input.value) || 0;
        }
      });

      // Update growth
      competitorData.performance.forEach((item, index) => {
        const input = document.getElementById(`growth-${index}`);
        if (input) {
          item.growth = Number(input.value) || 0;
        }
      });

      renderCompetitorAnalysis();
      updateLastUpdated();
      alert('Data kompetitor berhasil disimpan!');
    });

    // Tab Switching
    function switchTab(tab) {
      activeTab = tab;
      
      if (tab === 'dashboard') {
        dashboardView.classList.remove('hidden');
        managementView.classList.add('hidden');
        dashboardTab.classList.add('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        dashboardTab.classList.remove('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
        managementTab.classList.remove('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        managementTab.classList.add('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
      } else {
        dashboardView.classList.add('hidden');
        managementView.classList.remove('hidden');
        managementTab.classList.add('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        managementTab.classList.remove('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
        dashboardTab.classList.remove('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        dashboardTab.classList.add('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
        
        // Render management views
        renderSchoolsManagement();
        renderTopProductsManagement();
        renderTopCustomersManagement();
        renderCompetitorManagement();
      }
    }

    dashboardTab.addEventListener('click', () => switchTab('dashboard'));
    managementTab.addEventListener('click', () => switchTab('management'));
    mobileDashboard.addEventListener('click', () => switchTab('dashboard'));
    mobileManagement.addEventListener('click', () => switchTab('management'));

    // Refresh Timestamp
    refreshTimestamp.addEventListener('click', () => {
      updateLastUpdated();
    });

    // Load AI Insights
    async function loadInsights() {
      isAiLoading = true;
      refreshAI.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Loading...';
      refreshAI.disabled = true;

      // Simulate AI analysis based on real data
      setTimeout(() => {
        const topSchool = getSortedSchools()[0];
        const totalRevenue = schools.reduce((sum, s) => sum + s.revenue, 0);
        const avgRevenue = totalRevenue / schools.length;
        
        aiInsights = [
          `${topSchool.name} memimpin dengan revenue Rp${formatCurrency(topSchool.revenue)}. Fokus pada produk ${topSchool.topProducts[0] || 'unggulan'}.`,
          `Rata-rata revenue sekolah: Rp${formatCurrency(avgRevenue)}. ${schools.filter(s => s.revenue > avgRevenue).length} sekolah di atas rata-rata.`,
          `Total transaksi mencapai ${schools.reduce((sum, s) => sum + s.salesCount, 0)} item dengan omzet total Rp${formatCurrency(totalRevenue)}.`
        ];
        
        renderAIInsights();
        
        isAiLoading = false;
        refreshAI.innerHTML = '<i class="fa-solid fa-brain"></i> Refresh AI Analysis';
        refreshAI.disabled = false;
      }, 1500);
    }

    // Render AI Insights
    function renderAIInsights() {
      if (aiInsights.length > 0) {
        let html = '';
        aiInsights.forEach((insight, idx) => {
          html += `
            <div class="bg-slate-50/50 p-4 rounded-2xl border border-slate-100 flex gap-3">
              <div class="w-5 h-5 bg-[#EC0000] text-white rounded-full flex items-center justify-center text-[10px] font-black shrink-0 mt-0.5">${idx + 1}</div>
              <p class="text-[11px] leading-relaxed font-bold text-slate-600">${insight}</p>
            </div>
          `;
        });
        aiInsightsContainer.innerHTML = html;
      }
    }

    // Sync Button (simulasi)
    syncButton.addEventListener('click', async () => {
      const url = sheetUrl.value.trim();
      if (!url) {
        alert('Masukkan URL Google Sheet terlebih dahulu');
        return;
      }

      syncButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Menyinkronkan...';
      syncButton.disabled = true;

      // Simulate sync
      setTimeout(() => {
        alert('Sinkronisasi berhasil! Data telah diperbarui.');
        syncButton.innerHTML = '<i class="fa-solid fa-rotate"></i> Sinkron';
        syncButton.disabled = false;
        updateLastUpdated();
        
        // Update UI
        renderPodium();
        renderLeaderboard();
        renderTopCustomers();
        renderCompetitorAnalysis();
      }, 2000);
    });

    // Save Headers
    saveHeaders.addEventListener('click', () => {
      headerLabels = {
        schoolName: headerSchool.value,
        studentCount: headerStudent.value,
        topStudent: headerTopStudent.value,
        className: headerClass.value,
        revenue: headerRevenue.value
      };
      
      localStorage.setItem('dashboard_header_labels', JSON.stringify(headerLabels));
      alert('Header labels berhasil disimpan!');
    });

    // Initial Render
    renderPodium();
    renderLeaderboard();
    renderTopCustomers();
    renderCompetitorAnalysis();
    updateLastUpdated();

    // Auto-refresh every 5 minutes
    setInterval(() => {
      updateLastUpdated();
    }, 300000);
  </script>
</body>
</html>
