<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>H.E.R.O - Highschool Entrepreneur Race OSIS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    * { font-family: 'Inter', sans-serif; }
    .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    .hover-scale { transition: transform 0.2s; }
    .hover-scale:hover { transform: scale(1.02); }
    .truncate-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-[#F7F8FA] min-h-screen">

  <!-- Main Container -->
  <div class="min-h-screen flex flex-col md:flex-row bg-[#F7F8FA]" id="app">
    
    <!-- Sidebar -->
    <aside class="w-full md:w-20 lg:w-64 bg-[#0F0F0F] text-white p-6 flex flex-col gap-8 md:flex hidden sticky top-0 h-screen border-r border-white/5 shadow-2xl">
      <div class="flex flex-col gap-1 items-center lg:items-start">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-gradient-to-br from-[#EC0000] to-[#800000] rounded-2xl flex items-center justify-center shadow-xl shadow-red-600/20 border border-white/10">
            <i class="fa-solid fa-rocket text-white text-2xl"></i>
          </div>
          <div class="hidden lg:block">
            <h1 class="font-black text-2xl tracking-tighter bg-gradient-to-r from-white via-slate-300 to-slate-500 bg-clip-text text-transparent uppercase">
              H.E.R.O
            </h1>
          </div>
        </div>
        <p class="text-[9px] uppercase font-bold text-slate-500 leading-tight mt-6 tracking-[0.15em] hidden lg:block opacity-60">
          Highschool Entrepreneur<br>Race OSIS
        </p>
      </div>

      <nav class="flex flex-col gap-3 mt-4">
        <button id="dashboardTab" class="flex items-center gap-4 p-4 rounded-2xl font-bold transition-all duration-300 bg-gradient-to-r from-[#EC0000] to-[#FF4D4D] text-white shadow-lg shadow-red-500/30">
          <i class="fa-solid fa-chart-pie w-5"></i> <span class="hidden lg:block text-sm">Race Board</span>
        </button>
        <button id="managementTab" class="flex items-center gap-4 p-4 rounded-2xl font-bold transition-all duration-300 text-slate-500 hover:text-white hover:bg-white/5">
          <i class="fa-solid fa-gear w-5"></i> <span class="hidden lg:block text-sm">Data Master</span>
        </button>
      </nav>

      <div class="mt-auto hidden lg:block">
        <div class="bg-gradient-to-br from-[#1F1F1F] to-[#0A0A0A] p-5 rounded-[1.5rem] border border-white/5 shadow-2xl relative overflow-hidden">
           <div class="flex items-center gap-2 text-[#FFB800] mb-2">
             <i class="fa-solid fa-trophy text-sm"></i>
             <span class="text-[10px] font-black uppercase tracking-[0.15em]">Telkomsel OSIS Race</span>
           </div>
           <p class="text-[11px] text-slate-400 leading-relaxed font-medium">Monitoring Penjualan Sekolah Mitra.</p>
        </div>
      </div>
    </aside>

    <!-- Mobile Sidebar Toggle (Visible on mobile only) -->
    <div class="md:hidden bg-[#0F0F0F] text-white p-4 flex justify-between items-center sticky top-0 z-50">
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 bg-gradient-to-br from-[#EC0000] to-[#800000] rounded-xl flex items-center justify-center">
          <i class="fa-solid fa-rocket text-white"></i>
        </div>
        <h1 class="font-black text-xl">H.E.R.O</h1>
      </div>
      <div class="flex gap-2">
        <button id="mobileDashboard" class="p-2 bg-[#EC0000] rounded-lg text-white">
          <i class="fa-solid fa-chart-pie"></i>
        </button>
        <button id="mobileManagement" class="p-2 bg-white/10 rounded-lg text-white">
          <i class="fa-solid fa-gear"></i>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 p-3 md:p-8 lg:p-12 overflow-y-auto">
      <!-- Header -->
      <header class="mb-8 md:mb-12 flex flex-col lg:flex-row justify-between items-center gap-4 md:gap-6">
        <div class="flex items-center gap-4 md:gap-6">
          <h2 class="text-xl md:text-3xl font-black text-slate-900 tracking-tighter uppercase">Race <span class="text-[#EC0000]">Monitoring</span></h2>
          <div class="flex items-center gap-2 md:gap-3 text-[8px] md:text-[10px] font-black text-slate-400 bg-white px-3 md:px-5 py-1.5 md:py-2.5 rounded-xl md:rounded-2xl border border-slate-200 shadow-sm">
            <i class="fa-regular fa-clock text-[#EC0000] text-xs"></i> UPDATE: <span id="lastUpdated">19:30:45</span>
          </div>
        </div>
        <div class="flex items-center gap-2 md:gap-3">
           <div class="bg-white px-3 md:px-5 py-1.5 md:py-2.5 rounded-xl md:rounded-2xl border border-slate-200 text-[10px] md:text-xs font-bold text-slate-600 shadow-sm flex items-center gap-2">
              <i class="fa-regular fa-calendar text-[#FFB800]"></i> <span id="currentPeriod">Maret 2025</span>
           </div>
           <button id="refreshTimestamp" class="p-2 md:p-3 bg-white border border-slate-200 text-slate-400 hover:text-[#EC0000] rounded-xl md:rounded-2xl transition-all shadow-sm">
              <i class="fa-solid fa-rotate-right"></i>
           </button>
        </div>
      </header>

      <!-- Dashboard View -->
      <div id="dashboardView" class="space-y-10 md:space-y-16 pb-12">
        
        <!-- AI Insight Bar -->
        <section class="bg-white border border-slate-200 p-8 rounded-[2.5rem] shadow-sm relative overflow-hidden group">
           <div class="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity">
              <i class="fa-solid fa-brain text-[#EC0000] text-8xl"></i>
           </div>
           <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 relative z-10">
              <div class="space-y-4 flex-1">
                 <div class="flex items-center gap-3">
                    <div class="p-2 bg-red-50 text-[#EC0000] rounded-xl">
                       <i class="fa-solid fa-sparkles"></i>
                    </div>
                    <h3 class="text-sm font-black uppercase tracking-widest text-slate-800">Analisis Strategi AI</h3>
                 </div>
                 <div id="aiInsightsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- AI Insights will be injected here -->
                    <div class="col-span-3 py-4 flex items-center gap-3 text-slate-400">
                      <i class="fa-solid fa-circle-exclamation"></i>
                      <p class="text-xs font-black uppercase tracking-widest">Klik Refresh AI Analysis untuk memulai.</p>
                    </div>
                 </div>
              </div>
              <button id="refreshAI" class="flex items-center gap-3 px-8 py-5 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all bg-slate-900 text-white hover:bg-black shadow-xl shadow-black/10 hover:scale-105 active:scale-95">
                 <i class="fa-solid fa-brain"></i>
                 Refresh AI Analysis
              </button>
           </div>
        </section>
        
        <!-- PODIUM SECTION -->
        <section>
          <div class="flex items-center justify-between mb-6 md:mb-8">
            <div class="flex items-center gap-2 md:gap-3">
              <div class="p-2 bg-[#FFB800] text-white rounded-lg md:rounded-xl">
                <i class="fa-solid fa-trophy"></i>
              </div>
              <h3 class="text-[10px] md:text-sm font-black text-slate-800 uppercase tracking-widest italic flex items-center gap-2">
                Podium Jawara H.E.R.O <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse ml-2"></span>
              </h3>
            </div>
          </div>

          <div id="podiumContainer" class="grid grid-cols-3 gap-1.5 md:gap-8 items-end px-0.5 md:px-0">
            <!-- Podium will be dynamically populated -->
          </div>
        </section>

        <!-- FULL LEADERBOARD TABLE -->
        <div class="space-y-8">
          <div class="flex items-center gap-4 mb-2">
             <div class="p-2.5 bg-slate-900 text-white rounded-xl">
               <i class="fa-solid fa-school"></i>
             </div>
             <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest italic">Tabel Klasemen Harian</h3>
          </div>

          <div class="bg-white rounded-[2.5rem] shadow-2xl shadow-slate-200/40 border border-slate-100 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-left border-collapse">
                <thead>
                  <tr class="bg-slate-50/50 text-slate-400 text-[10px] uppercase font-black tracking-widest border-b border-slate-100">
                    <th class="px-6 md:px-10 py-6 text-center">No</th>
                    <th class="px-6 md:px-10 py-6">Nama Sekolah</th>
                    <th class="px-6 md:px-10 py-6 text-right">Total Omzet</th>
                    <th class="px-6 md:px-10 py-6 text-center">Trend</th>
                  </tr>
                </thead>
                <tbody id="leaderboardBody" class="divide-y divide-slate-100">
                  <!-- Leaderboard rows will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Data Management View (Hidden by default) -->
      <div id="managementView" class="hidden space-y-8">
        <div class="bg-white rounded-[2.5rem] p-8 shadow-xl">
          <h3 class="text-xl font-black mb-6">Data Master</h3>
          
          <!-- Sync Section -->
          <div class="mb-8">
            <label class="block text-sm font-bold mb-2">URL Google Sheet</label>
            <div class="flex gap-2">
              <input type="url" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." class="flex-1 p-3 border rounded-xl">
              <button id="syncButton" class="bg-[#EC0000] text-white px-6 py-3 rounded-xl font-bold hover:bg-[#cc0000] transition-all flex items-center gap-2">
                <i class="fa-solid fa-rotate"></i> Sinkron
              </button>
            </div>
          </div>

          <!-- Header Labels Configuration -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div>
              <label class="block text-xs font-bold mb-1">Nama Sekolah</label>
              <input type="text" id="headerSchool" value="Nama Sekolah" class="w-full p-2 border rounded-lg">
            </div>
            <div>
              <label class="block text-xs font-bold mb-1">Siswa (Angka)</label>
              <input type="text" id="headerStudent" value="Siswa (Angka)" class="w-full p-2 border rounded-lg">
            </div>
            <div>
              <label class="block text-xs font-bold mb-1">Siswa Terbaik (Teks)</label>
              <input type="text" id="headerTopStudent" value="Siswa Terbaik (Teks)" class="w-full p-2 border rounded-lg">
            </div>
            <div>
              <label class="block text-xs font-bold mb-1">Kelas</label>
              <input type="text" id="headerClass" value="Kelas" class="w-full p-2 border rounded-lg">
            </div>
            <div>
              <label class="block text-xs font-bold mb-1">Revenue (Rp)</label>
              <input type="text" id="headerRevenue" value="Revenue (Rp)" class="w-full p-2 border rounded-lg">
            </div>
          </div>

          <button id="saveHeaders" class="bg-slate-900 text-white px-8 py-4 rounded-xl font-bold hover:bg-black transition-all">
            Simpan Perubahan
          </button>
        </div>

        <!-- Schools List for Management -->
        <div class="bg-white rounded-[2.5rem] p-8 shadow-xl">
          <h4 class="font-black mb-4">Daftar Sekolah</h4>
          <div id="schoolsManagementList" class="space-y-2">
            <!-- Will be populated dynamically -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- School Detail Modal -->
  <div id="schoolModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white rounded-[2.5rem] max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-8">
        <div class="flex justify-between items-start mb-6">
          <h3 id="modalSchoolName" class="text-2xl font-black">Nama Sekolah</h3>
          <button id="closeModal" class="p-2 hover:bg-slate-100 rounded-full">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
        <div id="modalContent" class="space-y-4">
          <!-- Modal content will be populated -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Constants
    const SCHOOLS_DATA = [
      {
        id: "1",
        idDigipos: "SMA001",
        name: "SMA NEGERI 1 MALANG",
        revenue: 125000000,
        prevRevenue: 100000000,
        salesCount: 1250,
        lastSale: "2024-03-15",
        trend: "up",
        region: "Malang",
        topProducts: ["Kuota 10GB", "Pulsa 20k"],
        totalTransactions: 1250,
        studentCount: 1200,
        topStudentName: "Budi Santoso",
        teacherCount: 65,
        topClass: "XI IPA 1",
        topActiveStudents: [],
        carrierStats: { telkomsel: 70, indosat: 20, xl: 10 },
        dailySales: []
      },
      {
        id: "2",
        idDigipos: "SMA002",
        name: "SMA KRISTEN 2 SURABAYA",
        revenue: 98000000,
        prevRevenue: 95000000,
        salesCount: 980,
        lastSale: "2024-03-15",
        trend: "up",
        region: "Surabaya",
        topProducts: ["Paket Belajar"],
        totalTransactions: 980,
        studentCount: 900,
        topStudentName: "Maria Wijaya",
        teacherCount: 55,
        topClass: "XII IPS 2",
        topActiveStudents: [],
        carrierStats: { telkomsel: 60, indosat: 30, xl: 10 },
        dailySales: []
      },
      {
        id: "3",
        idDigipos: "SMA003",
        name: "SMA MUHAMMADIYAH 3 JAKARTA",
        revenue: 87500000,
        prevRevenue: 88000000,
        salesCount: 875,
        lastSale: "2024-03-14",
        trend: "stable",
        region: "Jakarta",
        topProducts: ["Pulsa 50k"],
        totalTransactions: 875,
        studentCount: 1100,
        topStudentName: "Ahmad Fauzi",
        teacherCount: 70,
        topClass: "XI IPA 2",
        topActiveStudents: [],
        carrierStats: { telkomsel: 75, indosat: 15, xl: 10 },
        dailySales: []
      },
      {
        id: "4",
        idDigipos: "SMA004",
        name: "SMA KATOLIK ST. ALBERTUS",
        revenue: 72000000,
        prevRevenue: 75000000,
        salesCount: 720,
        lastSale: "2024-03-13",
        trend: "down",
        region: "Malang",
        topProducts: ["Kuota 5GB"],
        totalTransactions: 720,
        studentCount: 800,
        topStudentName: "Kevin Alexander",
        teacherCount: 48,
        topClass: "X IPA 3",
        topActiveStudents: [],
        carrierStats: { telkomsel: 65, indosat: 25, xl: 10 },
        dailySales: []
      },
      {
        id: "5",
        idDigipos: "SMA005",
        name: "SMA NEGERI 5 BANDUNG",
        revenue: 65000000,
        prevRevenue: 62000000,
        salesCount: 650,
        lastSale: "2024-03-15",
        trend: "up",
        region: "Bandung",
        topProducts: ["Paket Data"],
        totalTransactions: 650,
        studentCount: 950,
        topStudentName: "Rina Wijayanti",
        teacherCount: 62,
        topClass: "XII MIPA 1",
        topActiveStudents: [],
        carrierStats: { telkomsel: 80, indosat: 12, xl: 8 },
        dailySales: []
      }
    ];

    // State variables
    let schools = [...SCHOOLS_DATA];
    let activeTab = 'dashboard';
    let aiInsights = [];
    let isAiLoading = false;
    let lastUpdated = new Date().toLocaleTimeString('id-ID');
    let selectedSchool = null;
    let headerLabels = {
      schoolName: 'Nama Sekolah',
      studentCount: 'Siswa (Angka)',
      topStudent: 'Siswa Terbaik (Teks)',
      className: 'Kelas',
      revenue: 'Revenue (Rp)'
    };

    // DOM Elements
    const dashboardView = document.getElementById('dashboardView');
    const managementView = document.getElementById('managementView');
    const dashboardTab = document.getElementById('dashboardTab');
    const managementTab = document.getElementById('managementTab');
    const mobileDashboard = document.getElementById('mobileDashboard');
    const mobileManagement = document.getElementById('mobileManagement');
    const refreshTimestamp = document.getElementById('refreshTimestamp');
    const lastUpdatedSpan = document.getElementById('lastUpdated');
    const currentPeriodSpan = document.getElementById('currentPeriod');
    const refreshAI = document.getElementById('refreshAI');
    const aiInsightsContainer = document.getElementById('aiInsightsContainer');
    const podiumContainer = document.getElementById('podiumContainer');
    const leaderboardBody = document.getElementById('leaderboardBody');
    const schoolModal = document.getElementById('schoolModal');
    const closeModal = document.getElementById('closeModal');
    const syncButton = document.getElementById('syncButton');
    const sheetUrl = document.getElementById('sheetUrl');
    const saveHeaders = document.getElementById('saveHeaders');
    const schoolsManagementList = document.getElementById('schoolsManagementList');

    // Header input elements
    const headerSchool = document.getElementById('headerSchool');
    const headerStudent = document.getElementById('headerStudent');
    const headerTopStudent = document.getElementById('headerTopStudent');
    const headerClass = document.getElementById('headerClass');
    const headerRevenue = document.getElementById('headerRevenue');

    // Initialize header inputs
    headerSchool.value = headerLabels.schoolName;
    headerStudent.value = headerLabels.studentCount;
    headerTopStudent.value = headerLabels.topStudent;
    headerClass.value = headerLabels.className;
    headerRevenue.value = headerLabels.revenue;

    // Helper Functions
    function formatCurrency(amount) {
      return new Intl.NumberFormat('id-ID').format(amount);
    }

    function updateLastUpdated() {
      lastUpdated = new Date().toLocaleTimeString('id-ID');
      lastUpdatedSpan.textContent = lastUpdated;
    }

    function getCurrentPeriod() {
      const date = new Date();
      return new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(date);
    }

    // Set current period
    currentPeriodSpan.textContent = getCurrentPeriod();

    // Sort schools by revenue
    function getSortedSchools() {
      return [...schools].sort((a, b) => b.revenue - a.revenue);
    }

    // Get top 3 schools
    function getTopThree() {
      const sorted = getSortedSchools();
      return sorted.slice(0, 3);
    }

    // Render Podium
    function renderPodium() {
      const topThree = getTopThree();
      let html = '';

      // Default podium if less than 3 schools
      while (topThree.length < 3) {
        topThree.push({
          id: `empty-${topThree.length}`,
          name: '-',
          region: '-',
          revenue: 0
        });
      }

      // Silver (2nd)
      if (topThree[1]) {
        html += `
          <div onclick="openSchoolModal('${topThree[1].id}')" class="bg-white border-b-2 md:border-b-4 border-slate-300 p-2 md:p-8 rounded-xl md:rounded-[2.5rem] shadow-lg md:shadow-xl hover:-translate-y-2 transition-all cursor-pointer group relative overflow-hidden">
            <div class="absolute top-0 right-0 p-2 md:p-6 opacity-5 md:opacity-10 group-hover:opacity-20 transition-opacity">
              <i class="fa-solid fa-trophy text-4xl md:text-7xl text-slate-400"></i>
            </div>
            <div class="w-6 h-6 md:w-14 md:h-14 bg-slate-100 rounded-lg md:rounded-2xl flex items-center justify-center text-slate-400 font-black text-[10px] md:text-xl mb-2 md:mb-6 border border-slate-200">2</div>
            <h4 class="text-[8px] md:text-xl font-black text-slate-800 leading-tight mb-1 md:mb-2 uppercase group-hover:text-[#EC0000] transition-colors truncate">${topThree[1].name}</h4>
            <p class="text-[6px] md:text-xs font-bold text-slate-400 mb-2 md:mb-6 truncate">${topThree[1].region}</p>
            <div class="pt-2 md:pt-6 border-t border-slate-50 flex justify-between items-end">
              <div class="flex-1 min-w-0">
                <p class="text-[5px] md:text-[10px] font-black text-slate-400 uppercase tracking-widest mb-0.5 md:mb-1">Realtime Revenue</p>
                <p class="text-[8px] md:text-lg font-black text-slate-900 truncate">Rp${formatCurrency(topThree[1].revenue)}</p>
              </div>
              <i class="fa-solid fa-chevron-right text-slate-200 group-hover:text-[#EC0000] transform group-hover:translate-x-1 transition-all text-xs md:text-base"></i>
            </div>
          </div>
        `;
      }

      // Gold (1st)
      html += `
        <div onclick="openSchoolModal('${topThree[0].id}')" class="bg-gradient-to-br from-[#121212] to-[#000000] p-3 md:p-10 rounded-2xl md:rounded-[3rem] shadow-2xl hover:-translate-y-4 transition-all cursor-pointer group relative overflow-hidden z-10 scale-105 border-b-4 md:border-b-8 border-[#FFB800]">
          <div class="absolute top-0 right-0 p-3 md:p-8 text-[#FFB800] opacity-10 md:opacity-20">
            <i class="fa-solid fa-crown text-5xl md:text-8xl"></i>
          </div>
          <div class="w-8 h-8 md:w-16 md:h-16 bg-[#FFB800] rounded-lg md:rounded-2xl flex items-center justify-center text-white font-black text-xs md:text-2xl mb-3 md:mb-8 shadow-lg shadow-yellow-500/30 relative">
            <i class="fa-solid fa-trophy text-white text-sm md:text-2xl"></i>
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-[#EC0000] rounded-full border-2 border-black animate-ping"></div>
          </div>
          <h4 class="text-[10px] md:text-2xl font-black text-white leading-tight mb-1 md:mb-3 uppercase tracking-tighter truncate">${topThree[0].name}</h4>
          <p class="text-[7px] md:text-sm font-bold text-slate-400 mb-3 md:mb-8 truncate">${topThree[0].region}</p>
          <div class="pt-3 md:pt-8 border-t border-white/10 flex justify-between items-end">
            <div class="overflow-hidden flex-1">
              <p class="text-[5px] md:text-[10px] font-black text-[#FFB800] uppercase tracking-widest mb-0.5 md:mb-1">Leader Revenue (Live)</p>
              <p class="text-[10px] md:text-2xl font-black text-white tracking-tighter truncate">Rp${formatCurrency(topThree[0].revenue)}</p>
            </div>
            <div class="bg-[#EC0000] p-1 md:p-3 rounded-md md:rounded-2xl text-white shadow-lg shrink-0 ml-2">
              <i class="fa-solid fa-sparkles text-xs md:text-base"></i>
            </div>
          </div>
        </div>
      `;

      // Bronze (3rd)
      if (topThree[2]) {
        html += `
          <div onclick="openSchoolModal('${topThree[2].id}')" class="bg-white border-b-2 md:border-b-4 border-amber-600 p-2 md:p-8 rounded-xl md:rounded-[2.5rem] shadow-lg md:shadow-xl hover:-translate-y-2 transition-all cursor-pointer group relative overflow-hidden">
            <div class="absolute top-0 right-0 p-2 md:p-6 opacity-5 md:opacity-10">
              <i class="fa-solid fa-trophy text-4xl md:text-7xl text-amber-700"></i>
            </div>
            <div class="w-6 h-6 md:w-14 md:h-14 bg-amber-50 rounded-lg md:rounded-2xl flex items-center justify-center text-amber-700 font-black text-[10px] md:text-xl mb-2 md:mb-6 border border-amber-100">3</div>
            <h4 class="text-[8px] md:text-xl font-black text-slate-800 leading-tight mb-1 md:mb-2 uppercase group-hover:text-[#EC0000] transition-colors truncate">${topThree[2].name}</h4>
            <p class="text-[6px] md:text-xs font-bold text-slate-400 mb-2 md:mb-6 truncate">${topThree[2].region}</p>
            <div class="pt-2 md:pt-6 border-t border-slate-50 flex justify-between items-end">
              <div class="flex-1 min-w-0">
                <p class="text-[5px] md:text-[10px] font-black text-slate-400 uppercase tracking-widest mb-0.5 md:mb-1">Realtime Revenue</p>
                <p class="text-[8px] md:text-lg font-black text-slate-900 truncate">Rp${formatCurrency(topThree[2].revenue)}</p>
              </div>
              <i class="fa-solid fa-chevron-right text-slate-200 group-hover:text-[#EC0000] transform group-hover:translate-x-1 transition-all text-xs md:text-base"></i>
            </div>
          </div>
        `;
      }

      podiumContainer.innerHTML = html;
    }

    // Render Leaderboard Table
    function renderLeaderboard() {
      const sorted = getSortedSchools();
      let html = '';

      sorted.forEach((school, index) => {
        const trendIcon = school.trend === 'up' 
          ? '<i class="fa-solid fa-trend-up"></i>' 
          : school.trend === 'down' 
            ? '<i class="fa-solid fa-trend-down"></i>' 
            : '<i class="fa-solid fa-minus"></i>';
        
        const trendClass = school.trend === 'up' 
          ? 'text-emerald-600 bg-emerald-50' 
          : school.trend === 'down' 
            ? 'text-red-600 bg-red-50' 
            : 'text-slate-400 bg-slate-50';

        html += `
          <tr onclick="openSchoolModal('${school.id}')" class="hover:bg-slate-50 transition-all group cursor-pointer">
            <td class="px-6 md:px-10 py-6 text-center">
              <span class="text-sm font-black text-slate-300 group-hover:text-[#EC0000] transition-colors">${index + 1}</span>
            </td>
            <td class="px-6 md:px-10 py-6">
              <p class="font-black text-slate-800 text-xs md:text-base group-hover:text-[#EC0000] transition-colors uppercase tracking-tighter truncate max-w-[120px] md:max-w-none">${school.name}</p>
              <p class="text-[8px] text-slate-400 font-bold uppercase">${school.region} â€¢ ${school.idDigipos}</p>
            </td>
            <td class="px-6 md:px-10 py-6 text-right">
              <p class="font-mono font-black text-slate-900 text-xs md:text-base">Rp${formatCurrency(school.revenue)}</p>
              <p class="text-[9px] text-[#EC0000] font-black uppercase tracking-widest">${school.salesCount} ITEMS SOLD</p>
            </td>
            <td class="px-6 md:px-10 py-6 text-center">
               <div class="inline-flex items-center gap-1 ${trendClass} px-3 py-1 rounded-full text-[10px] font-black border uppercase">
                  ${trendIcon} ${school.trend === 'up' ? 'Naik' : school.trend === 'down' ? 'Turun' : 'Stable'}
               </div>
            </td>
          </tr>
        `;
      });

      leaderboardBody.innerHTML = html;
    }

    // Render Schools Management List
    function renderSchoolsManagement() {
      let html = '';
      schools.forEach((school, index) => {
        html += `
          <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl">
            <div>
              <p class="font-bold">${school.name}</p>
              <p class="text-xs text-slate-500">ID: ${school.idDigipos} | Revenue: Rp${formatCurrency(school.revenue)}</p>
            </div>
            <button onclick="editSchool('${school.id}')" class="text-[#EC0000] hover:text-[#cc0000]">
              <i class="fa-solid fa-edit"></i>
            </button>
          </div>
        `;
      });
      schoolsManagementList.innerHTML = html;
    }

    // Load AI Insights
    async function loadInsights() {
      isAiLoading = true;
      refreshAI.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Loading...';
      refreshAI.disabled = true;

      // Simulate AI analysis
      setTimeout(() => {
        aiInsights = [
          'SMA Negeri 1 Malang unggul 27% dari pesaing terdekat. Fokus pada produk Kuota 10GB.',
          'SMA Kristen 2 Surabaya menunjukkan pertumbuhan konsisten 3% per minggu.',
          'SMA Muhammadiyah 3 Jakarta perlu revitalisasi strategi penjualan untuk kelas XII.'
        ];
        
        renderAIInsights();
        
        isAiLoading = false;
        refreshAI.innerHTML = '<i class="fa-solid fa-brain"></i> Refresh AI Analysis';
        refreshAI.disabled = false;
      }, 1500);
    }

    // Render AI Insights
    function renderAIInsights() {
      if (aiInsights.length > 0) {
        let html = '';
        aiInsights.forEach((insight, idx) => {
          html += `
            <div class="bg-slate-50/50 p-4 rounded-2xl border border-slate-100 flex gap-3">
              <div class="w-5 h-5 bg-[#EC0000] text-white rounded-full flex items-center justify-center text-[10px] font-black shrink-0 mt-0.5">${idx + 1}</div>
              <p class="text-[11px] leading-relaxed font-bold text-slate-600">${insight}</p>
            </div>
          `;
        });
        aiInsightsContainer.innerHTML = html;
      }
    }

    // Open School Modal
    window.openSchoolModal = function(schoolId) {
      const school = schools.find(s => s.id === schoolId);
      if (!school) return;

      selectedSchool = school;
      document.getElementById('modalSchoolName').textContent = school.name;
      
      const modalContent = document.getElementById('modalContent');
      modalContent.innerHTML = `
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div class="p-4 bg-slate-50 rounded-xl">
              <p class="text-xs text-slate-500">ID Digipos</p>
              <p class="font-bold">${school.idDigipos}</p>
            </div>
            <div class="p-4 bg-slate-50 rounded-xl">
              <p class="text-xs text-slate-500">Region</p>
              <p class="font-bold">${school.region}</p>
            </div>
            <div class="p-4 bg-slate-50 rounded-xl">
              <p class="text-xs text-slate-500">Revenue</p>
              <p class="font-bold text-[#EC0000]">Rp${formatCurrency(school.revenue)}</p>
            </div>
            <div class="p-4 bg-slate-50 rounded-xl">
              <p class="text-xs text-slate-500">Total Transaksi</p>
              <p class="font-bold">${school.totalTransactions}</p>
            </div>
            <div class="p-4 bg-slate-50 rounded-xl">
              <p class="text-xs text-slate-500">Jumlah Siswa</p>
              <p class="font-bold">${school.studentCount}</p>
            </div>
            <div class="p-4 bg-slate-50 rounded-xl">
              <p class="text-xs text-slate-500">Jumlah Guru</p>
              <p class="font-bold">${school.teacherCount}</p>
            </div>
          </div>
          
          <div class="p-4 bg-slate-50 rounded-xl">
            <p class="text-xs text-slate-500 mb-2">Siswa Terbaik</p>
            <p class="font-bold">${school.topStudentName}</p>
          </div>
          
          <div class="p-4 bg-slate-50 rounded-xl">
            <p class="text-xs text-slate-500 mb-2">Kelas Jawara</p>
            <p class="font-bold">${school.topClass}</p>
          </div>
        </div>
      `;
      
      schoolModal.classList.remove('hidden');
    };

    // Close Modal
    closeModal.addEventListener('click', () => {
      schoolModal.classList.add('hidden');
      selectedSchool = null;
    });

    // Click outside to close
    schoolModal.addEventListener('click', (e) => {
      if (e.target === schoolModal) {
        schoolModal.classList.add('hidden');
        selectedSchool = null;
      }
    });

    // Tab Switching
    function switchTab(tab) {
      activeTab = tab;
      
      if (tab === 'dashboard') {
        dashboardView.classList.remove('hidden');
        managementView.classList.add('hidden');
        dashboardTab.classList.add('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        dashboardTab.classList.remove('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
        managementTab.classList.remove('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        managementTab.classList.add('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
      } else {
        dashboardView.classList.add('hidden');
        managementView.classList.remove('hidden');
        managementTab.classList.add('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        managementTab.classList.remove('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
        dashboardTab.classList.remove('bg-gradient-to-r', 'from-[#EC0000]', 'to-[#FF4D4D]', 'text-white', 'shadow-lg', 'shadow-red-500/30');
        dashboardTab.classList.add('text-slate-500', 'hover:text-white', 'hover:bg-white/5');
        
        renderSchoolsManagement();
      }
    }

    dashboardTab.addEventListener('click', () => switchTab('dashboard'));
    managementTab.addEventListener('click', () => switchTab('management'));
    mobileDashboard.addEventListener('click', () => switchTab('dashboard'));
    mobileManagement.addEventListener('click', () => switchTab('management'));

    // Refresh Timestamp
    refreshTimestamp.addEventListener('click', () => {
      updateLastUpdated();
    });

    // Refresh AI
    refreshAI.addEventListener('click', loadInsights);

    // Sync Button
    syncButton.addEventListener('click', async () => {
      const url = sheetUrl.value.trim();
      if (!url) {
        alert('Masukkan URL Google Sheet terlebih dahulu');
        return;
      }

      syncButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Menyinkronkan...';
      syncButton.disabled = true;

      // Simulate sync
      setTimeout(() => {
        alert('Sinkronisasi berhasil! Data telah diperbarui.');
        syncButton.innerHTML = '<i class="fa-solid fa-rotate"></i> Sinkron';
        syncButton.disabled = false;
        updateLastUpdated();
        
        // Update UI
        renderPodium();
        renderLeaderboard();
      }, 2000);
    });

    // Save Headers
    saveHeaders.addEventListener('click', () => {
      headerLabels = {
        schoolName: headerSchool.value,
        studentCount: headerStudent.value,
        topStudent: headerTopStudent.value,
        className: headerClass.value,
        revenue: headerRevenue.value
      };
      
      localStorage.setItem('dashboard_header_labels', JSON.stringify(headerLabels));
      alert('Header labels berhasil disimpan!');
    });

    // Edit School (placeholder)
    window.editSchool = function(schoolId) {
      alert(`Edit school ${schoolId} - Fitur akan segera tersedia`);
    };

    // Initial Render
    renderPodium();
    renderLeaderboard();
    updateLastUpdated();

    // Auto-refresh every 5 minutes
    setInterval(() => {
      updateLastUpdated();
    }, 300000);
  </script>
</body>
</html>
